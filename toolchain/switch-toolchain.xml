<xml>

<set name="NO_PRECOMPILED_HEADERS" value="1" if="GCC_OLD" />
<set name="USE_PRECOMPILED_HEADERS" value="gcc" unless="NO_PRECOMPILED_HEADERS"/>

<set name="USE_GCC_FILETYPES" value="1"/>

<linker id="static_link" exe="ar" unless="windows">
  <ext value="${LIBEXT}"/>

  <exe name="${EXEPREFIX}-ar" if="EXEPREFIX" />
  <exe name="${HXCPP_AR}" if="HXCPP_AR" />
  <fromfile value="" if="GCC_OLD" />
  <fromfile value="" if="tizen" />
  <fromfile value="" if="blackberry" />
  <outflag value="-cr "/>
  <outflag value="cr " if="emscripten" />
  <section if="HXCPP_USE_LIBTOOL">
     <exe name="libtool"  />
     <exe name="${HXCPP_LIBTOOL}" if="HXCPP_LIBTOOL" />
     <outflag value="-o "  />
     <fromfile value="-filelist " needsQuotes="false" />
  </section>
  <!-- <outflag value="-o " if="emscripten" /> -->
  <recreate value="1" unless="HXCPP_LIBTOOL" />

  <expandAr value="1" if="android" />
  <expandAr value="1" if="emscripten" />
  <expandAr value="1" if="linux" />
  <section unless="HXCPP_USE_LIBTOOL">
     <ranlib name="ranlib" />
     <ranlib name="${EXEPREFIX}-ranlib" if="EXEPREFIX" />
     <ranlib name="${HXCPP_RANLIB}" if="HXCPP_RANLIB" />
  </section>
</linker>

<set name="nostrip" value="1" if="debug"/>
<set name="nostrip" value="1" if="dll_import"/>
<set name="nostrip" value="1" if="dll_export"/>
<set name="nostrip" value="1" if="HXCPP_DEBUG_LINK"/>
<unset name="nostrip" if="HXCPP_DEBUG_LINK_AND_STRIP"/>

<compiler id="switch" exe="aarch64-none-elf-g++">
    <exe name="${CXX}" if="CXX" />
    <flag value="-c"/>
    <flag value="-fvisibility=hidden"/>
    <cppflag value="-frtti"/>
    <cppflag value="-std=c++11" if="HXCPP_CPP11" />
    <cppflag value="-std=c++17" if="HXCPP_CPP17"/>
    <flag value="-g" if="debug"/>
    <flag value="-O2" unless="debug"/>
    <flag value="-fpic"/>
    <flag value="-fPIC"/>
    <flag value="-Wno-overflow" />
    <cppflag value="-Wno-invalid-offsetof" />
    
    <include name="toolchain/common-defines.xml" />
    <flag value="-DHXCPP_M64" if="HXCPP_M64"/>
    <flag value="-I${HXCPP}/include"/>
    <flag value="-I${MINGW_ROOT}/include"/>
    <flag value="-I${DEVKITPRO}/libnx/include"/>

    <!--LIB Links-->
    <flag value="-L${MINGW_ROOT}/usr/lib" />
    <flag value="-L${DEVKITPRO}/libnx/lib" />
    <flag value="-L${DEVKITPRO}/libnx/lib/gcc/aarch64-none-elf/8.3.0" />

    <objdir value="obj/switch${OBJEXT}/"/>
    <outflag value="-o"/>
    <ext value=".o"/>
</compiler>

<linker id="exe" exe="aarch64-none-elf-g++">
    <exe name="${CXX}" if="CXX" />
    <fromfile value="" if="GCC_OLD" />
    <flag value="-debug" if="debug"/>
    <ext value=".elf"/>
    <outflag value="-o "/>
</linker>

<stripper id="strip" exe="elf2nro">
    <!--Create the .nro from the .elf and romfs/control.nacp-->

    <exe name="elf2nro"/>
    <flag value="obj/ApplicationMain.elf obj/ApplicationMain.nro --nacp=obj/control.nacp"/>

</stripper>

</xml>